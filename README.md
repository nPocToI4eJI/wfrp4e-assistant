# WFRP4e - Assistant
Этот модуль поможет Мастеру проводить игры комфортно. В него включены исправления ошибок и недоработок системы и официальных модулей, а также собственные и адаптированные инструменты.

## Содержание
- [Исправления](#Исправления)
  - [Core Rulebook](#Core-Rulebook)
  - [Winds of Magic](#Winds-of-Magic)
  - [Archives of the Empire: II](#Archives-of-the-Empire-II)
  - [Tribes & Tribulations](#Tribes-&-Tribulations)
- [Методы](#Методы)
  - [getMagicLoreKey](#getMagicLoreKeylore)
  - [findAllSpells](#findAllSpellslore-includeArcane)
  - [generateBookTitle](#generateBookTitletype)
  - [getActorFromUUID](#getActorFromUUID)
  - [getSpeciesKey](#getSpeciesKey)
- [Макросы](#Макросы)
  - [Придумать ругательство](#Придумать-ругательство)
  - [Название книги](#Название-книги)
- [Помощник](#Помощник)
  - [Случайное имя](#Случайное-имя)
  - [Случайные характеристики](#Случайные-характеристики)
  - [Изменение характеристик](#Изменение-характеристик)
  - [Окраска токена при смерти](#Окраска-токена-при-смерти)
  - [Случайные заклинания](#Случайные-заклинания)
  - [Сохранить актёра](#Сохранить-актёра)

## Исправления
Здесь перечислены исправления и доработки системы и официальных модулей.

#### Core Rulebook
Исправлены скрипты эффектов.
- Новый скрипт Зачарованного посоха позволяет использовать переведённые названия Магических Школ.
- Новый скрипт магических Одеяний позволяет использовать переведённые названия Магических Школ.

Исправлены методы, взаимодействующие с актёром через использование его Народа. Теперь они принимают и переведённые значения Народов.

Во вкладке **"Бой"** добавлена кнопка для управления состоянием **"Уход в защиту"**:
<img width="130" height="30" alt="image" src="https://github.com/user-attachments/assets/cfba184f-932d-4a5a-a8e8-10655a54fd34"/> <img width="130" height="30" alt="image" src="https://github.com/user-attachments/assets/666698c6-05cd-4818-9d4c-803b17532288"/>

#### Winds of Magic
_Добавлены новые скрипты на генерацию случайных гримуаров и свитков заклинаний._

Макросы позволяют генерировать заклинания как случайных Магических Школ, так и выбранных пользователем. Он включает в себя настройки, которые позволят ещё больше оптимизировать процесс использования макросов.

Магические Школы:
- [X] Core Rulebook
- [X] Archives of the Empire: Vol II.
- [X] Winds of Magic
- [X] The Horned Rat
- [X] Tribes & Tribulations

#### Archives of the Empire: II
_Добавлены ключи локализации для Школы Магии и Ветра Магии "Великой Пасти"._

Ключи локализации:
```
"WFRP4E.MagicLores.greatmaw": "Великая Пасть",
"WFRP4E.MagicWind.greatmaw": "Великая Пасть",
"WFRP4E.greatmaw.descriptions": "<p>Всякий раз, когда огр-мясник успешно применяет заклинания Великой пасти, съеденное им подношение может восстановить здоровье. Совершите бросок [[/r 1d10]]. Если результат 10, или равен, или превышает ПС произносимого заклинания, Мясник восстанавливает раны, равные ПС заклинания.</p>"
```

#### Tribes & Tribulations
_Добавлены ключи локализации для Школ Магии и Ветров Магии "Вааагх!"._

Ключи локализации:
```
"WFRP4E.MagicLores.little-waaagh": "Малый Вааагх!",
"WFRP4E.MagicWind.little-waaagh": "Малый Вааагх!",
"WFRP4E.little-waaagh.descriptions": "<p>Заклинания Гоблинов-шаманов (и некоторых хобгоблинов), как правило, проявляют \"Вааагх!\" в виде злобных трюков и заговоров. Уверенность гоблинов-шаманов растет по мере того, как их заклинания срабатывают. Если он получает дополнительные УУ в результате проверки Сотворения Заклинания, то может потратить их по правилам Избытка магии или использовать для покупки одного Очка удачи. Очки удачи, полученные таким образом, могут накапливаться сверх максимального значения, но должны быть потрачены до конца боя или будут потеряны.</p>",
"WFRP4E.MagicLores.big-waaagh": "Большой Вааагх!",
"WFRP4E.MagicWind.big-waaagh": "Большой Вааагх!",
"WFRP4E.big-waaagh.descriptions": "<p>Заклинания \"Большого Вааагха!\" служат проводниками огромного количества \"Вааагх!\" энергии, и её высвобождение ободряет сердца орков, гоблинов и хобгоблинов, находящихся поблизости. Всякий раз, когда Персонаж произносит заклинание \"Большого Вааагх!\" все орки, хобгоблины и гоблины, находящиеся в пределах Силы воли ярдов, теряют все состояния @Condition[В панике].</p>"
```

## Методы
В модуле присутствуют новые методы, которые нужны для работы макросов и скриптов. Тем не менее, они могут быть использованы и извне.

#### getMagicLoreKey(lore)
_Этот метод принимает переведённое название Школы Магии и возвращает ключ, принадлежащий этой Школе._
- **lore** _(String)_: переведённое название Школы Магии.

Пример: `game.wfrp4eAssistant.utility.getMagicLoreKey("Знахарство")` вернёт `"hedgecraft"`.

#### findAllSpells(lore, includeArcane)
_Этот метод принимает ключ Школы Магии и возвращает массив, содержащий заклинания, принадлежащие этой Школе._
- **lore** _(String)_: ключ Школы Магии. Список ключей можно узнать при помощи методов:
  - `game.wfrp4e.config.magicLores //Объект. Ключи с переводом.`
  - `Object.keys(game.wfrp4e.config.magicLores) //Массив. Ключи без перевода.`
- **includeArcane** _(Boolean)_:
  - **true**: в возвращаемый массив будут включены и общие заклинания (заклинания без указания Школы Магии);
  - **false**: в возвращаемый массив будут включены только заклинания указанной Школы Магии.

Пример: `game.wfrp4eAssistant.utility.findAllSpells("hedgecraft", true)` вернёт массив, содержащий все заклинания Школы Магии Знахарства и общие заклинания (заклинания без указания Школы Магии).

Метод сначала проверяет заклинания, находящиеся в предметах, а после - в библиотеках. Если заклинания имеют одинаковое название _(полностью совпадающее)_, добавляется только первое найденное. Заклинания из **Основного модуля** обрабатываются в последнюю очередь.

#### generateBookTitle(type)
_Этот метод генерирует случайное название для книги в стилистике сеттинга. Варианты названий взяты у [Paco's Miscellaneous Stuff](https://pacomiscelaneousstuff.blogspot.com/2020/02/wfrp4-random-book-generator.html) и переведены мной на русский._
- **type** _(String)_: тема генерируемой книги. Значения **"Random"** или **""** выбирают случайную тему.

##### Добавление своих вариантов.
_Метод позволяет добавлять свои варианты к существующим темам, а так же создавать свои темы для генерации._

Темы находятся напрямую в файлах перевода. Существующие можно найти по пути **"WFRP4E.Assistant.BooksTitle.Types"**, а входящие в искомую тему варианты: **"WFRP4E.Assistant.BooksTitle.{Ключ темы}"**.

Для того, чтобы добавить свои варианты к существующей теме, необходимо добавить их по пути **"WFRP4E.Assistant.BooksTitle.{Ключ темы}.{Ключ своего варианта}"**.  
Рекомендуется использовать собственный префикс для **{Ключ своего варианта}**, чтобы избежать перезаписи другими модулями:
```
"Medicine": {
    "my1": "Мой вариант",
    "my2": "Тоже мой вариант",
    "my3": "Это мой вариант?"
}
```
Для добавления своего варианта, необходимо указать его ключ и перевод в **"WFRP4E.Assistant.BooksTitle.Types"**, а варианты вписать в **"WFRP4E.Assistant.BooksTitle.{Ключ темы}"**:
```
"Types": {
    "MyType": "Моя тема"
},
"MyType": {
    "1": "Мой вариант",
    "2": "Тоже мой вариант",
    "3": "Это мой вариант?"
}
```
Пример использования: `game.wfrp4eAssistant.utility.generateBookTitle("Medicine")` или `game.wfrp4eAssistant.utility.generateBookTitle("MyType")`.

#### getActorFromUUID(uuid)
_Этот метод принимает полный UUID и возвращает актёра. Принимает UUID в формате "Scene.*id*.Token.*id*.Actor.*id*" или "Actor.*id*"._
- **uuid** _(String)_: полный UUID, который можно получить, нажав на "Копирование UUID" в шапке актёра.

Пример: `game.wfrp4eAssistant.utility.getActorFromUUID("Actor.H1DazXpCBBJ42fsF")` вернёт актёра с id = "H1DazXpCBBJ42fsF".

#### getSpeciesKey(string)
_Этот метод принимает переведённое название Народа и возвращает ключ, принадлежащий этому Народу._
- **string** _(String)_: переведённое название Народа.

Пример: `game.wfrp4eAssistant.utility.getSpeciesKey("Человек (Рейкландец)")` вернёт `"human"`.

## Макросы
Модуль добавляет несколько макросов для оптимизации игрового процессе.

#### Придумать ругательство
_Этот макрос генерирует оскорбления в фэнтезийном стиле. Хотя, они больше подходят для персонажей-гномов, найти им применение можно везде._

Примеры:
- _Невнятный, гоблинский, плакса._
- _Слащавый, предательский, дикарь._
- _Вонючий, с рвотой вместо мозгов, проходимец._

#### Название книги
_Этот макрос использует метод [generateBookTitle](#generateBookTitletype), представляя удобный интерфейс для взаимодействия и выводя результат в чат._

Примеры:
- _Комплексные справки про битву на Перевале Чёрного Огня._
- _Основные лекции о реальных опасностях неизученных трав._
- _Насущные заметки о чудесах Зоологии._

## Помощник
_Модуль добавляет возможность оптимизировать листы НИП и Существ._

Доступ к окну Помощника можно получить через вкладку **"Переключения управления"**:\
<img width="250" height="300" alt="image" src="https://github.com/user-attachments/assets/15430723-b666-4787-b1fe-9c3d1ff987de"/>

Само окно выглядит так:\
<img width="600" height="375" alt="image" src="https://github.com/user-attachments/assets/1af28a09-a13b-4e4d-97b9-94c8d7d8c970"/>

#### Случайное имя
_Если включено, при переносе токена на сцену, для него будет сгенерировано случайное имя._

Имеющиеся имена находятся напрямую в файлах перевода. Существующие Народы можно найти по пути **"WFRP4E.Assistant.Helpers.GenerateName.List"**. Нужный ключ указывется в первом окне ввода. Во втором, через запятую, указываются необходимые для генерации имени выбранного Актёра ключи, находящиеся внутри ключа Народа.

Для того, чтобы добавить имена для существующих народов, необходимо добавить собственный ключ по пути **"WFRP4E.Assistant.Helpers.GenerateName.List**, а в него, ключи необходимых для генерации таблиц, в которых будут находится сами имена. Пример:
```
"WFRP4E.Assistant.Helpers.GenerateName.List": {
    "human": {
        "male": {
            "1": "Абельхайм",
            "2": "Абельхард",
            "3": "Адам",
            "4": "Адельманн",
            "5": "Адельхард"
        },
        "female": {
            "1": "Агата",
            "2": "Аделина",
            "3": "Адель",
            "4": "Айседора",
            "5": "Алиса"
        }
    }
}
```

#### Случайные характеристики
_Если включено, при переносе токена на сцену, для него будет сгенерированы случайные характеристики, согласно Книге Правил._

Задает случайные значения характеристик, вычитая из указанного значения 10 пунктов, а затем прибавляя 2d10 пунктов. Таким образом, указанное значение характеристики 30 превратится в случайное, равное 20 + 2d10. Если характеристика равна 5, просто бросает 1d10 и указывает полученный результат как новое значение характеристики.

#### Изменение характеристик
_Изменяет начальные значения характеристик актёра на указанное число._

#### Окраска токена при смерти
_Если раны актёра снизятся до 0, токен будет окрашен в указанный цвет._

#### Случайные заклинания
_Если включено, при переносе токена на сцену, ему будет выдано указанное количество случайных заклинаний выбранной Магической Школы._

#### Сохранить актёра
_Позволяет сохранить актрёра, находящегося на сцене, как отдельный лист._

Если актёр находится на сцене, и данные его токена не привязаны к оригинальному листу, в окне Помощника будет отображена кнопка Экспорта лица:\
<img width="600" height="50" alt="image" src="https://github.com/user-attachments/assets/f2dae6d4-37ad-48d7-aca7-e31a850281c4"/>

Можно заметить, что многие пункты срабатывают и изменяют актёра только при его появлении на сцене, при этом не влияя на оригинальный лист. В случае, когда подобный, уже _случайно изменённый_ актёр, настолько Вам приглянулся, что Вы захотели его сохранить, пригодится эта кнопка.\
Экспортированному актёру может потребоваться некоторая настройка, но все сгенерированные Помощником значения сохранятся.
