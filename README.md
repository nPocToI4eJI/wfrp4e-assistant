# WFRP4e - Assistant
Этот модуль поможет Мастеру проводить игры комфортно. В него включены исправления ошибок и недоработок системы и официальных модулей, а также собственные и адаптированные инструментыю

## Содержание
- [Исправления](#Исправления)
  - [Warhammer Library](#Warhammer-Library)
  - [Winds of Magic](#Winds-of-Magic)
  - [Archives of the Empire: II](#Archives-of-the-Empire-II)
- [Методы](#Методы)
  - [getMagicLoreKey](#getMagicLoreKey(lore))
  - [findAllSpells](#findAllSpells(lore-includeArcane))
  - [generateBookTitle](#generateBookTitle(type))
- [Макросы](#Макросы)
  - [Придумать ругательство](#Придумать-ругательство)
  - [Название книги](#Название-книги)
- [Черты-помощники](#Черты-помощники)
  - _В процессе написания_

## Исправления
Здесь перечислены исправления и доработки системы и официальных модулей.

#### Warhammer Library
_Исправлен скрипт эффекта для Зачарованного посоха._

Новый скрипт позволяет присваивать и использовать локализованные названия Магических Школ для работы скрипта Зачарованного Посоха.
```
//Код
let lore = game.wfrp4eAssistant.utility.getMagicLoreKey(this.effect.name.split(" ")[2]);
if (args.item.type == "spell" && args.item.system.lore.value == lore) {
    args.item.system.cn.value = Math.max(0, args.item.system.cn.value - 1);
};
```

#### Winds of Magic
_Добавлены новые скрипты на генерацию случайных гримуаров и свитков заклинаний._

Макросы позволяют генерировать заклинания как случайных Магических Школ, так и указанных пользователем.
<p align="center">
    <img width="250" height="175" alt="Меню генерации" src="https://github.com/user-attachments/assets/8d19c089-f2c9-46f0-b5b0-23233b830b20"/>
    <img width="200" height="250" alt="Выбор Магической Школы" src="https://github.com/user-attachments/assets/3678c225-765f-43ec-8554-d5bdeea34a3c"/>
    <img width="200" height="300" alt="Готовый Свиток заклинания" src="https://github.com/user-attachments/assets/6b845053-ef50-4563-ac07-a592acde1567"/>
    <img width="200" height="300" alt="Готовый Гримуар" src="https://github.com/user-attachments/assets/e81bfe51-f7be-4491-9cac-20a4e8ef0855"/>
</p>

Модуль включает в себя настройки, которые позволят ещё больше оптимизировать процесс их использования.
<p align="center"><img width="300" height="200" alt="Настройки" src="https://github.com/user-attachments/assets/5d7fa4b3-8d2d-46b1-8140-f910ad5806ff"/></p>

Магические Школы:
- [X] Core Rulebook
- [X] Archives of the Empire: Vol II.
- [X] Winds of Magic
- [ ] The Horned Rat
- [ ] Salzenmund: City of Salt and Silver*

_*Данные модули у меня отсутствуют._

#### Archives of the Empire: II
_Добавлены ключи локализации для Школы Магии и Ветра Магии "Великой Пасти"._

Ключи локализации:
```
"WFRP4E.MagicLores.greatmaw": "Великая Пасть",
"WFRP4E.MagicWind.greatmaw": "Великая Пасть",
"WFRP4E.greatmaw.descriptions": "<p>Всякий раз, когда огр-мясник успешно применяет заклинания Великой пасти, съеденное им подношение может восстановить здоровье. Совершите бросок [[/r 1d10]]. Если результат 10, или равен, или превышает ПС произносимого заклинания, Мясник восстанавливает раны, равные ПС заклинания.</p>"
```

## Методы
В модуле присутствуют новые методы, которые нужны для работы макросов и скриптов. Тем не менее, они могут быть использованы и извне.

#### getMagicLoreKey(lore)
_Этот метод принимает переведённое название Школы Магии и возвращает ключ, принадлежащий этой Школе._
- **lore** _(String)_: переведённое название Школы Магии.

Пример: `game.wfrp4eAssistant.utility.getMagicLoreKey("Знахарство")` вернёт `"hedgecraft"`.

#### findAllSpells(lore, includeArcane)
_Этот метод принимает ключ Школы Магии и возвращает массив, содержащий заклинания, принадлежащие этой Школе._
- **lore** _(String)_: ключ Школы Магии. Список ключей можно узнать при помощи методов:
  - `game.wfrp4e.config.magicLores //Объект. Ключи с переводом.`
  - `Object.keys(game.wfrp4e.config.magicLores) //Массив. Ключи без перевода.`
- **includeArcane** _(Boolean)_:
  - **true**: в возвращаемый массив будут включены и общие заклинания (заклинания без указания Школы Магии);
  - **false**: в возвращаемый массив будут включены только заклинания указанной Школы Магии.

Пример: `game.wfrp4eAssistant.utility.findAllSpells("hedgecraft", true)` вернёт массив, содержащий все заклинания Школы Магии Знахарства.

Метод сначала проверяет заклинания, находящиеся в предметах, а только после - в библиотеках. Если заклинания имеют одинаковое название _(полностью совпадающее)_, добавляется только первое найденное. Заклинания из Основного модуля обрабатываются в последнюю очередь.

#### generateBookTitle(type)
_Этот метод генерирует случайное название для книги в стилистике сеттинга. Варианты названий взяты у [Paco's Miscellaneous Stuff](https://pacomiscelaneousstuff.blogspot.com/2020/02/wfrp4-random-book-generator.html) и переведены мной на русский._
- **type** _(String)_: тема генерируемой книги. Значение **"Random"** выбирает случайную тему.

##### Добавление своих вариантов.
_Метод позволяет добавлять свои варианты к существующим темам, а так же создавать свои темы для генерации._

Темы находятся напрямую в файлах перевода. Существующие можно найти по пути **"WFRP4E.Assistant.BooksTitle.Types"**, а входящие в искомую тему варианты: **"WFRP4E.Assistant.BooksTitle.{Ключ темы}"**.

Для того, чтобы добавить свои варианты к существующей теме, необходимо добавить их по пути **"WFRP4E.Assistant.BooksTitle.{Ключ темы}.{Ключ своего варианта}"**.  
Рекомендуется использовать собственный префикс для **{Ключ своего варианта}**, чтобы избежать перезаписи другими модулями:
```
"Medicine": {
    "my1": "Мой вариант",
    "my2": "Тоже мой вариант",
    "my3": "Это мой вариант?"
}
```
Для добавления своего варианта, необходимо указать его ключ и перевод в **"WFRP4E.Assistant.BooksTitle.Types"**, а варианты вписать в **"WFRP4E.Assistant.BooksTitle.{Ключ темы}"**:
```
"Types": {
    "MyType": "Моя тема"
},
"MyType": {
    "1": "Мой вариант",
    "2": "Тоже мой вариант",
    "3": "Это мой вариант?"
}
```
Пример использования: `game.wfrp4eAssistant.utility.generateBookTitle("Medicine")` или `game.wfrp4eAssistant.utility.generateBookTitle("MyType")`.

## Макросы
Модуль добавляет несколько макросов для оптимизации игрового процессе.

#### Придумать ругательство
_Этот макрос генерирует оскорбления в фэнтезийном стиле. Хотя, они больше подходят для персонажей-гномов, найти им применение можно везде._

Примеры:
- _Невнятный, гоблинский, плакса._
- _Слащавый, предательский, дикарь._
- _Вонючий, с рвотой вместо мозгов, проходимец._

#### Название книги
_Этот макрос использует метод [generateBookTitle](#generateBookTitle), представляя удобный интерфейс для взаимодействия и выводя результат в чат._

Примеры:
- _Комплексные справки про битву на Перевале Чёрного Огня._
- _Основные лекции о реальных опасностях неизученных трав._
- _Насущные заметки о чудесах Зоологии._
