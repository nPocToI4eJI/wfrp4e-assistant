# WFRP4e - Assistant
Этот модуль поможет Мастеру проводить игры комфортно. В него включены исправления ошибок и недоработок системы и официальных модулей, а также собственные и адаптированные инструменты.

## Содержание
- [Исправления](#Исправления)
  - [Warhammer Library](#Warhammer-Library)
  - [Winds of Magic](#Winds-of-Magic)
  - [Archives of the Empire: II](#Archives-of-the-Empire-II)
- [Методы](#Методы)
  - [getMagicLoreKey](#getMagicLoreKeylore)
  - [findAllSpells](#findAllSpellslore-includeArcane)
  - [generateBookTitle](#generateBookTitletype)
- [Макросы](#Макросы)
  - [Придумать ругательство](#Придумать-ругательство)
  - [Название книги](#Название-книги)
- [Черты-помощники](#Черты-помощники)
  - [Генератор имени](#Генератор-имени)
  - [Изменение размера](#Изменение-размера)
  - [Изменение характеристик](#Изменение-характеристик)
  - [Маг](#Маг)
  - [Наложение цвета при смерти](#Наложение-цвета-при-смерти)
  - [Случайные значения характеристик](#Случайные-значения-характеристик)
  - [Сохранить актёра](#Сохранить-актёра)
  - [Уход в защиту](#Уход-в-защиту)

## Исправления
Здесь перечислены исправления и доработки системы и официальных модулей.

#### Warhammer Library
_Исправлен скрипт эффекта для Зачарованного посоха._

Новый скрипт позволяет присваивать и использовать локализованные названия Магических Школ для работы скрипта Зачарованного Посоха.
```
//Код
let lore = game.wfrp4eAssistant.utility.getMagicLoreKey(this.effect.name.split(" ")[2]);
if (args.item.type == "spell" && args.item.system.lore.value == lore) {
    args.item.system.cn.value = Math.max(0, args.item.system.cn.value - 1);
};
```

#### Winds of Magic
_Добавлены новые скрипты на генерацию случайных гримуаров и свитков заклинаний._

Макросы позволяют генерировать заклинания как случайных Магических Школ, так и указанных пользователем.
<p align="center">
    <img width="250" height="175" alt="Меню генерации" src="https://github.com/user-attachments/assets/8d19c089-f2c9-46f0-b5b0-23233b830b20"/>
    <img width="200" height="250" alt="Выбор Магической Школы" src="https://github.com/user-attachments/assets/3678c225-765f-43ec-8554-d5bdeea34a3c"/>
    <img width="200" height="300" alt="Готовый Свиток заклинания" src="https://github.com/user-attachments/assets/6b845053-ef50-4563-ac07-a592acde1567"/>
    <img width="200" height="300" alt="Готовый Гримуар" src="https://github.com/user-attachments/assets/e81bfe51-f7be-4491-9cac-20a4e8ef0855"/>
</p>

Модуль включает в себя настройки, которые позволят ещё больше оптимизировать процесс их использования.
<p align="center"><img width="300" height="200" alt="Настройки" src="https://github.com/user-attachments/assets/5d7fa4b3-8d2d-46b1-8140-f910ad5806ff"/></p>

Магические Школы:
- [X] Core Rulebook
- [X] Archives of the Empire: Vol II.
- [X] Winds of Magic
- [ ] The Horned Rat
- [ ] Salzenmund: City of Salt and Silver*

_*Данные модули у меня отсутствуют._

#### Archives of the Empire: II
_Добавлены ключи локализации для Школы Магии и Ветра Магии "Великой Пасти"._

Ключи локализации:
```
"WFRP4E.MagicLores.greatmaw": "Великая Пасть",
"WFRP4E.MagicWind.greatmaw": "Великая Пасть",
"WFRP4E.greatmaw.descriptions": "<p>Всякий раз, когда огр-мясник успешно применяет заклинания Великой пасти, съеденное им подношение может восстановить здоровье. Совершите бросок [[/r 1d10]]. Если результат 10, или равен, или превышает ПС произносимого заклинания, Мясник восстанавливает раны, равные ПС заклинания.</p>"
```

## Методы
В модуле присутствуют новые методы, которые нужны для работы макросов и скриптов. Тем не менее, они могут быть использованы и извне.

#### getMagicLoreKey(lore)
_Этот метод принимает переведённое название Школы Магии и возвращает ключ, принадлежащий этой Школе._
- **lore** _(String)_: переведённое название Школы Магии.

Пример: `game.wfrp4eAssistant.utility.getMagicLoreKey("Знахарство")` вернёт `"hedgecraft"`.

#### findAllSpells(lore, includeArcane)
_Этот метод принимает ключ Школы Магии и возвращает массив, содержащий заклинания, принадлежащие этой Школе._
- **lore** _(String)_: ключ Школы Магии. Список ключей можно узнать при помощи методов:
  - `game.wfrp4e.config.magicLores //Объект. Ключи с переводом.`
  - `Object.keys(game.wfrp4e.config.magicLores) //Массив. Ключи без перевода.`
- **includeArcane** _(Boolean)_:
  - **true**: в возвращаемый массив будут включены и общие заклинания (заклинания без указания Школы Магии);
  - **false**: в возвращаемый массив будут включены только заклинания указанной Школы Магии.

Пример: `game.wfrp4eAssistant.utility.findAllSpells("hedgecraft", true)` вернёт массив, содержащий все заклинания Школы Магии Знахарства и общие заклинания (заклинания без указания Школы Магии).

Метод сначала проверяет заклинания, находящиеся в предметах, а после - в библиотеках. Если заклинания имеют одинаковое название _(полностью совпадающее)_, добавляется только первое найденное. Заклинания из **Основного модуля** обрабатываются в последнюю очередь.

#### generateBookTitle(type)
_Этот метод генерирует случайное название для книги в стилистике сеттинга. Варианты названий взяты у [Paco's Miscellaneous Stuff](https://pacomiscelaneousstuff.blogspot.com/2020/02/wfrp4-random-book-generator.html) и переведены мной на русский._
- **type** _(String)_: тема генерируемой книги. Значение **"Random"** выбирает случайную тему.

##### Добавление своих вариантов.
_Метод позволяет добавлять свои варианты к существующим темам, а так же создавать свои темы для генерации._

Темы находятся напрямую в файлах перевода. Существующие можно найти по пути **"WFRP4E.Assistant.BooksTitle.Types"**, а входящие в искомую тему варианты: **"WFRP4E.Assistant.BooksTitle.{Ключ темы}"**.

Для того, чтобы добавить свои варианты к существующей теме, необходимо добавить их по пути **"WFRP4E.Assistant.BooksTitle.{Ключ темы}.{Ключ своего варианта}"**.  
Рекомендуется использовать собственный префикс для **{Ключ своего варианта}**, чтобы избежать перезаписи другими модулями:
```
"Medicine": {
    "my1": "Мой вариант",
    "my2": "Тоже мой вариант",
    "my3": "Это мой вариант?"
}
```
Для добавления своего варианта, необходимо указать его ключ и перевод в **"WFRP4E.Assistant.BooksTitle.Types"**, а варианты вписать в **"WFRP4E.Assistant.BooksTitle.{Ключ темы}"**:
```
"Types": {
    "MyType": "Моя тема"
},
"MyType": {
    "1": "Мой вариант",
    "2": "Тоже мой вариант",
    "3": "Это мой вариант?"
}
```
Пример использования: `game.wfrp4eAssistant.utility.generateBookTitle("Medicine")` или `game.wfrp4eAssistant.utility.generateBookTitle("MyType")`.

## Макросы
Модуль добавляет несколько макросов для оптимизации игрового процессе.

#### Придумать ругательство
_Этот макрос генерирует оскорбления в фэнтезийном стиле. Хотя, они больше подходят для персонажей-гномов, найти им применение можно везде._

Примеры:
- _Невнятный, гоблинский, плакса._
- _Слащавый, предательский, дикарь._
- _Вонючий, с рвотой вместо мозгов, проходимец._

#### Название книги
_Этот макрос использует метод [generateBookTitle](#generateBookTitletype), представляя удобный интерфейс для взаимодействия и выводя результат в чат._

Примеры:
- _Комплексные справки про битву на Перевале Чёрного Огня._
- _Основные лекции о реальных опасностях неизученных трав._
- _Насущные заметки о чудесах Зоологии._

## Черты-помощники
Модуль добавляет несколько новых черт, каждая из которых содержит скрипты, позволяющие не заморачиваться над некоторыми аспектами повествования.

#### Генератор имени
_Эта черта генерирует имя при спавне токена актёра, которому она выдана._

Как только актёр с этой чертой переносится на сцену, созданному токену и привязанному к этому токену актёру присваивается случайно сгенерированное имя. Так как скрипт срабатывает, только если токен не привязан к актёру, он не приводить к перезаписи оригинального листа.\
Скрипт сам определяет **Народ** и **Пол** персонажа. Если **Пол** персонажа не указан, но необходим, пользователю предлагается его выбрать. На данный момент доступна генерация для следующих **Народов**:
- Человек (мужчина).
- Человек (женщина).
- Гоблин.

#### Изменение размера
_Эта черта позволяет изменять размер персонажа во время игры._

Если актёр с этой чертой находится на сцене, Вы можете изменять его размер с помощью кнопок **"Увеличить"** и **"Уменьшить"** в листе персонажа.\
При изменении размера добавляюся соответствующие изменения характеристик и выдаётся соответствующая новому размеру черта **"Размер ()"**.

#### Изменение характеристик
_Эта черта позволяет разом изменить все характеристики актёра._

В специализации этой черты указывается числовое значение для изменения начальных характеристик актёра. Изменения применяются автоматически и не являются модификаторами, а значит не учитываются в ограничении модификаторов.

#### Маг
_Эта черта выдаёт указанное количество заклинаний выбранной Школы Магии при спавне токена актёра._

Когда черта выдается персонажу, Вам предлагается её настроить, а именно:
- Выбрать Школу Магии;
- Указать количество заклинаний;
- Указать, добавлять ли к выбранной Школе Магии общие заклинания (заклинания без указания Школы Магии).

Как только актёр с этой чертой переносится на сцену, ему выдаётся указанное количество заклинаний выбранной Школы Магии. Это очень полезно для _рядовых_ персонажей магов, над чьими заклинаниями Вы не хотите задумываться.

#### Наложение цвета при смерти
_Эта черта окрашивает токен актёра в указанный цвет, когда его раны снижаются до 0._

Если актёр с этой чертой находится на сцене, а его раны снижаются до **0**, токен актёра окрашивается в указанный в специализации черты цвет _(цвет указывается в формате HEX)_. Как только количество ран увеличивается, окрашивание пропадает.

#### Случайные значения характеристик
_Эта черта генерирует случайные характеристики при спавне токена актёра, которому она выдана._

Как только актёр с этой чертой переносится на сцену, созданному токену и привязанному к этому токену актёру присваиваются случайно сгенерированные характеристики. Так как скрипт срабатывает, только если токен не привязан к актёру, он не приводить к перезаписи оригинального листа.

Характеристики генерируются согласно **Книге Правил**, а именно:
> Чтобы задать случайное значение **характеристики**, вычти из указанного в бестиарии значения **10 пунктов**, а затем прибавь **2d10 пунктов**. Таким образом, заданное значение **характеристики** _30_ превратится в случайное, равное _20 + 2d10_. Если **характеристика** равна **5**, просто брось **1d10** и запиши полученный результат как новое значение этой **характеристики**.

#### Сохранить актёра
_Эта черта позволяет сохранить актрёра, находящегося на сцене, как отдельный лист._

Можно заметить, что многие скрипты срабатывают и изменяют актёра только при его появлении на сцене, при этом не изменяя оригинальный лист. В случае, когда подобный, уже _случайно изменённый_ актёр, настолько Вам приглянулся, что Вы захотели его сохранить, пригодится этот макрос.\
Сохранённому актёру может потребоваться некоторая настройка, но все сгенерированные чертами из этого модуля значения сохранятся.

#### Уход в защиту
_Эта черта позволяет применять действие **"Ухода в защиту"** без необходимости добавления эффекта системы._

Небольшой скрипт, который позволит применять действие **"Ухода в защиту"** из вкладки **Талантов**, давая возможность когда угодно изменять используемый навык или полностью отключать эффект.
